<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link
	  rel="stylesheet"
	  href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
	  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
	  crossorigin=""
	/>
	<!-- Make sure you put this AFTER Leaflet's CSS -->
	<script
		src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
  		integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
  		crossorigin=""></script>
	<title>mapsketch</title>

	<!-- <script src="libraries/p5.dom.js"></script>
	<script src="libraries/p5.js"></script>
	<script src="libraries/p5.sound.js"></script>
	<script src="sketch.js"></script> -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

	<style>
		#issMap {
			height: 300px;
		}
	</style>
</head>
<body>
	<h1> Wildfire Spread Simulation </h1>
	<p> latiude: <span id="lat"></span>°<br />
		longitude: <span id="long"></span>°
	</p>
	<div id="issMap"></div>
	<button name="reset" onclick="reset()">Reset</button>
	<p><a href="/run">Run python</a></p>

	<!-- <button id='simulate' name="start" onclick="simulate()">Start Simulation</button> -->

	<script>
	// -3aUREs6J1xZD-UA3F1AkfVbag-cB3

	let lat, lon;
	var interval;
	var python_done = false;
	var msg = 0;
	const mymap = L.map('issMap').setView([-29.906137, 25.244125], 4); // latitude, longitude, zoom level
	// mymap.on('click', onClick);
	// making a marker with a custom icon
	const flameIcon = L.icon({
    iconUrl: 'flame_2.png',
    iconSize: [30, 30],
    iconAnchor: [12, 15],
	});
	const markers = [];
	// const d = [];
	// const elevations_array = [];
	const lat_lons = [];
	// const marker = L.marker([0, 0], {icon: flameIcon}).addTo(mymap);
	const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
	const tileURL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
	const tiles = L.tileLayer(tileURL, {attribution});
	tiles.addTo(mymap);
	// const api_url = 'https://api.wheretheiss.at/v1/satellites/25544';
	// const api_url = 'https://api.open-elevation.com/api/v1/lookup\?locations\=10,10\|20,20\|41.161758,-8.583933';
	mymap.on('click', addMarker);

	async function addMarker(e){
    // Add marker to map at click location; add popup window
		if (markers.length < 2){
			const newMarker = new L.marker(e.latlng, {icon:flameIcon}).addTo(mymap);
			markers.push(newMarker);
			const {lat, lng} = e.latlng;
			// const data = [lat, lng];
			const data = { lat, lng };
			// console.log(data);
		    const options = {
				method: 'POST',
			 	headers: {
			    	'Content-Type': 'application/json',
					'Accept': 'application/json'
			 	},
			 	body: JSON.stringify(data)
		   	};
		    const response = await fetch('/api', options);
		    const json = await response.json();
			msg = await json;
		    console.log(msg);
		}
	}

	function reset(remove_markers){
		markers.forEach(marker => {
			mymap.removeLayer(marker);
		});
		markers.length = 0;
		lat_lons.length = 0
		msg = 0;
		// clearInterval(interval);
	}
	async function simulate(){

		if (msg == 2){
			getData();
			console.log('hello');
			clearInterval(interval);
		}
	}
	// document.getElementById('simulate').addEventListener('click', async event =>{
	// 		// 	console.log(json);
	// 		// }catch{
	// 		// 	console.log('error');
	// 		// }
	// });
	async function getData(){
		const xs = [];
		const ys = [];
		const response = await fetch('predicted_points.csv');
		const data = await response.text();
		console.log(data);
	}

	// async function onClick(e) {
	// 	await alert(L.getLatLng());
	// }
	interval = setInterval(simulate, 3000);
	</script>
</body>
</html>







