<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link
	  rel="stylesheet"
	  href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
	  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
	  crossorigin=""
	/>
	<!-- Make sure you put this AFTER Leaflet's CSS -->
	<script
		src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
  		integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
  		crossorigin=""></script>
	<title>mapsketch</title>

	<!-- <script src="libraries/p5.dom.js"></script>
	<script src="libraries/p5.js"></script>
	<script src="libraries/p5.sound.js"></script>
	<script src="sketch.js"></script> -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

	<style>
		#issMap {
			height: 300px;
		}
	</style>
</head>
<body>
	<h1> Wildfire Spread Simulation </h1>
	<p> latiude: <span id="lat"></span>°<br />
		longitude: <span id="long"></span>°
	</p>
	<div id="issMap"></div>
	<button name="reset" onclick="remove_markers()">Reset</button>
	<button id='simulate' name="start">Start Simulation</button>

	<script>
	// -3aUREs6J1xZD-UA3F1AkfVbag-cB3
	//
	//
	// if ('geolocation' in navigator){
	// 	console.log('geolocation available');
	// 	navigator.geolocation.getCurrentPosition(async position => {
	// 		const lat = position.coords.latitude;
	// 		const lng = position.coords.longitude;
	//
	// 		document.getElementById('lat').textContent = lat;
	// 		document.getElementById('long').textContent = lng;
	//
	// 		const data = {lat, lng};
	// 		const options = {
	// 			method: 'POST',
	// 			headers:{
	// 				'Content-Type':'application/json'
	// 			},
	// 			body: JSON.stringify(data)
	// 		};
	// 		const response = await fetch('/api', options);
	// 		const t = await response.json();
	// 		console.log(t);
	// 		});
	// 		// console.log(position);
	// }else{
	// 	console.log('geolocation not available');
	// }

	let lat, lon;
	var interval;
	const latitudes;
	const longitudes;
	const mymap = L.map('issMap').setView([-29.906137, 25.244125], 4); // latitude, longitude, zoom level
	// mymap.on('click', onClick);
	// making a marker with a custom icon
	const flameIcon = L.icon({
    iconUrl: 'flame_2.png',
    iconSize: [30, 30],
    iconAnchor: [12, 15],
	});
	const markers = [];
	const d = [];
	const elevations_array = [];
	// const marker = L.marker([0, 0], {icon: flameIcon}).addTo(mymap);
	const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
	const tileURL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
	const tiles = L.tileLayer(tileURL, {attribution});
	tiles.addTo(mymap);
	// const api_url = 'https://api.wheretheiss.at/v1/satellites/25544';
	// const api_url = 'https://api.open-elevation.com/api/v1/lookup\?locations\=10,10\|20,20\|41.161758,-8.583933';
	mymap.on('click', addMarker);

	function addMarker(e){
    // Add marker to map at click location; add popup window
		if (markers.length < 2){
			const newMarker = new L.marker(e.latlng, {icon:flameIcon}).addTo(mymap);
			markers.push(newMarker);
			d.push(e.latlng);
			// console.log(e.latlng);
			console.log(e);
		}
	}

	function remove_markers(){
		markers.forEach(marker => {
			mymap.removeLayer(marker);
		});
		markers.length = 0;
		d.length = 0;
		clearInterval(interval);
	}
	document.getElementById('simulate').addEventListener('click', async event =>{
		interval = setInterval(getData, 10000);
		if (d.length == 2){
			// goPython();
			d.forEach(async elt => {
				lat = elt.lat;
				lon = elt.lng;
				// const t = 'https://elevation-api.io/api/elevation?points=' + '(' + lat + ',' + lon + ')&key=-3aUREs6J1xZD-UA3F1AkfVbag-cB3';
				// // console.log(t);
				// // const t = 'https://api.open-elevation.com/api/v1/lookup\?locations\='+lat+','+lon + '\ ';
				// const msg = await fetch(t);
				// const elevation = await msg.json();
				// const ele = elevation.elevations[0].elevation;
				// console.log(ele)
				// get_elevation(lat, lon);
				// console.log(get_elevation(lat, lon));
				// console.log(api_url);
				// console.log(await elevations_array[0])
				const data = {lat, lon};
				console.log(data);
				const options = {
					method: 'POST',
					headers:{
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(data)
				};
				const response = await fetch('/api', options);
				const json = await response.json();
				console.log(json);
			});


		}
	});
	async function getData(){
		const xs = [];
		const ys = [];
		const response = await fetch('predicted_points.csv');
		const data = await response.text();
		console.log(data);
		// try {
        // 	// return true;
    	// } catch(err) {
        // 	// return false;
		// 	console.log(err);
    	// }

		// console.log(data);
		//
		// const table = data.split('\n').slice(1);
		// console.log(table);
		// table.forEach(row => {
		// 	const columns = row.split(',');
		// 	const latitude = columns[0];
		// 	const longitude = columns[1];
		// 	latitudes.push(parseFloat(latiude));
		// 	longitudes.push(parseFloat(longitudes));
		//
		// 	// const year = columns[0];
		// 	// xs.push(year);
		// 	// const temp = columns[1];
		// 	// ys.push(parseFloat(temp)+14);
		// 	// console.log(year, temp);
		// });
		// return {xs, ys};
	}

	async function onClick(e) {
		await alert(L.getLatLng());
	}
	// async function getISS(){
	// 	if (d.length == 2){
	// 		console.log('hello');
	// 		d.forEach(async elt => {
	// 			lat = elt.lat;
	// 			lon = elt.lng;

				// // console.log(elt)
				// const data = {lat, lon};
				// const options = {
				// 	method: 'POST',
				// 	headers:{
				// 		'Content-Type': 'application/json'
				//
				// 	},
				// 	body: JSON.stringify(data)
				// };
				// const response = await fetch('/api', options);
				// const json = await response.json();
				// console.log(json);

			// });
			// const response = await fetch(api_url);
			// const data = await response.json();

		// }
		// console.log(data.latitude, data.longitude);
		// const {latitude, longitude} = data;

		// if (markers.length == 2){
		//
		// 	// console.log(markers);
		// }
		// marker.on('click', function(e) {
		// 	marker.setLatLng([latitude, longitude]);
		// });
		// mymap.panBy([longitude, latitude]);
		// L.marker([latitude, longitude]).addTo(mymap);
		// document.getElementById('lat').textContent = latitude.toFixed(4);
		// document.getElementById('long').textContent = longitude.toFixed(4);
		// console.log(latitude);
		// console.log(longitude);
	// }
	// getISS();
	// setInterval(getISS, 2000);

	// interval = setInterval(getData, 10000);
	</script>
</body>
</html>







